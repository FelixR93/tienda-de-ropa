<div class="product-list-page">
  <h1>Productos</h1>

  <!-- Buscador -->
  <div class="search-bar">
    <input
      type="text"
      [(ngModel)]="searchTerm"
      placeholder="Buscar por nombre..."
    />
    <button (click)="onSearch()">Buscar</button>
  </div>

  <!-- Mensajes -->
  <div *ngIf="loading" class="info-text">
    Cargando productos...
  </div>

  <div *ngIf="errorMessage" class="error-text">
    {{ errorMessage }}
  </div>

  <!-- Grid de productos -->
  <div class="products-grid" *ngIf="!loading && !errorMessage">
    <div *ngIf="products.length === 0" class="info-text">
      No se encontraron productos.
    </div>

    <!-- Flip-card por cada producto -->
    <div
      class="product-card"
      *ngFor="let product of products"
    >
      <div
        class="product-card-inner"
        [class.flipped]="isFlipped(product)"
      >
        <!-- Frente -->
        <div
          class="product-card-front"
          (click)="toggleFlip(product, $event)"
        >
          <div class="front-image">
            <img
              [src]="getProductImage(product)"
              [alt]="product.name"
            />
          </div>

          <div class="front-body">
            <h3>{{ product.name }}</h3>
            <p class="price">
              {{ product.price | currency: 'USD':'symbol':'1.2-2' }}
            </p>
            <p class="category">
              {{ getCategoryName(product) }}
            </p>
          </div>
        </div>

        <!-- Reverso -->
        <div
          class="product-card-back"
          (click)="toggleFlip(product, $event)"
        >
          <div class="back-header">
            <h3>{{ product.name }}</h3>
            <p class="price">
              {{ product.price | currency: 'USD':'symbol':'1.2-2' }}
            </p>
          </div>

          <p class="description">
            {{ product.description || 'Sin descripci√≥n' }}
          </p>

          <div class="back-footer">
            <span
              class="stock"
              [class.out]="product.stock <= 0"
            >
              Stock:
              {{ product.stock > 0 ? product.stock : 'Agotado' }}
            </span>

            <div class="back-actions">
              <a
                [routerLink]="['/products', product._id]"
                class="btn-outline"
                (click)="$event.stopPropagation()"
              >
                Ver detalle
              </a>

              <button
                type="button"
                class="btn-primary"
                [disabled]="adding[product._id] || product.stock <= 0"
                (click)="addToCart(product, $event)"
              >
                {{
                  adding[product._id]
                    ? 'Agregando...'
                    : 'Agregar al carrito'
                }}
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- fin *ngFor -->
  </div>
</div>
