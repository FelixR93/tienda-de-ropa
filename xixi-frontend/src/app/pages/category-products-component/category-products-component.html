<div class="category-products-page">
  <h1 *ngIf="category; else defaultTitle">Categoría: {{ category.name }}</h1>
  <ng-template #defaultTitle>
    <h1>Productos por categoría</h1>
  </ng-template>

  <div *ngIf="loading" class="info-text">Cargando productos...</div>

  <div *ngIf="!loading && errorMessage" class="error-text">
    {{ errorMessage }}
  </div>

  <div class="products-grid" *ngIf="!loading && !errorMessage">
    <div *ngIf="products.length === 0" class="info-text">No hay productos en esta categoría.</div>

    <div class="product-card" *ngFor="let product of products">
      <div class="product-card-inner">
        <!-- Frente -->
        <div class="product-card-front">
          <img [src]="getProductImage(product)" [alt]="product.name" />

          <div class="front-body">
            <h3>{{ product.name }}</h3>
            <p class="price">
              {{ product.price | currency : 'USD' : 'symbol' : '1.2-2' }}
            </p>
          </div>
        </div>

        <!-- Pie: stock + botones -->
        <div class="back-footer">
          <span class="stock" [class.out]="product.stock <= 0">
            Stock: {{ product.stock > 0 ? product.stock : 'Agotado' }}
          </span>

          <div class="actions">
            <!-- Ojo: si tu ruta es /products/:id usa /products -->
            <a [routerLink]="['/products', product._id]" class="btn-outline"> Ver detalle </a>

            <button
              type="button"
              class="btn-add"
              (click)="addToCart(product)"
              [disabled]="product.stock <= 0"
            >
              Agregar al carrito
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
